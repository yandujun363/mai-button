<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>埋按钮 (:3っ)∋</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="favicon.jpg" type="image/jpeg">
</head>

<body>
    <!-- CDN选择界面 - 仅在多个CDN时显示 -->
    <div id="cdnSelectScreen" class="cdn-select-screen" style="display: none;">
        <div class="cdn-select-content">
            <div class="cdn-select-header">
                <h2>选择音频源</h2>
                <p class="cdn-select-desc">请选择一个音频加载源以开始使用</p>
            </div>
            
            <div class="cdn-options-container" id="cdnOptions">
                <!-- CDN选项会通过JS动态生成 -->
            </div>
            
            <div class="cdn-select-footer">
                <p class="cdn-note">选择后会开始加载音频资源，首次加载可能需要时间</p>
                <div class="cdn-storage-info">
                    <input type="checkbox" id="rememberCdn" checked>
                    <label for="rememberCdn">记住我的选择（使用浏览器本地存储）</label>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载界面 -->
    <div id="loadingScreen" class="loading-screen" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在加载音频资源...</div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="loadingProgress"></div>
                </div>
                <div class="progress-text" id="loadingProgressText">0/0</div>
            </div>
            <div class="loading-note">首次加载可能需要时间，音频会缓存在您的浏览器中</div>
            <div class="loading-cdn-info" id="loadingCdnInfo"></div>
        </div>
    </div>

    <!-- 主界面 -->
    <div id="mainContent" class="main-content" style="display: none;">
        <!-- 原有主界面内容保持不变 -->
        <header>
            <h1>埋按钮 (:3っ)∋</h1>
        </header>

        <div class="controls">
            <button id="randomPlay">随机播放</button>
            <button id="stopAll">停止所有</button>
            <label>
                <input type="checkbox" id="loopMode"> 洗脑循环
            </label>
            <button id="changeCdn" class="cdn-change-btn">更换音频源</button>
        </div>

        <main id="voiceContainer">
            <!-- 音频按钮会通过JS动态生成 -->
        </main>

        <footer class="app-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <p class="footer-text">
                        基于 <a href="https://github.com/CaoMeiYouRen/shirakami-haruka-button" target="_blank"
                            rel="noopener noreferrer">CaoMeiYouRen/shirakami-haruka-button</a> 制作
                        <span class="footer-note">（参考代码让AI重新写的纯原生版本，原项目炸了，用不了）</span>
                    </p>
                </div>

                <div class="footer-section">
                    <h3 class="footer-title">使用指南</h3>
                    <ul class="guide-list">
                        <li>点击按钮即可播放对应音声</li>
                        <li>多次点击可以造成相当鬼畜的效果</li>
                        <li>开启洗脑循环将会一直播放一个音频</li>
                        <li>同时开启循环播放和洗脑循环将会出现 <strong>地 狱 绘 卷</strong></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3 class="footer-title">相关链接</h3>
                    <a href="https://space.bilibili.com/3546775765912341" target="_blank" rel="noopener noreferrer"
                        class="footer-link">
                        主播空间
                    </a>
                    <a href="https://github.com/yandujun363/mai-button" target="_blank" rel="noopener noreferrer"
                        class="footer-link">
                        项目地址
                    </a>
                </div>
            </div>

            <div class="footer-bottom">
                <p class="copyright">© 2025 埋按钮 (:3っ)∋ - 仅供娱乐使用</p>
                <a href="https://www.yangdujun.top/" target="_blank">按钮太多了，塞我博客导航栏了</a><br>
                <a href="https://www.yangdujun.top" target="_blank">能不能来看看我博客</a><br>
                <a href="https://space.bilibili.com/7813737" target="_blank" rel="noopener noreferrer">感谢春虎Harutora提供的音频文件</a><br>
            </div>
        </footer>
    </div>

    <!-- 修改为模块化加载 -->
    <script type="module" src="app.js"></script>
    <!--
    Umami统计代码，如果要Fork部署，记得删除或者修改一下自己实现统计，如果你的统计也是Umaim，那么可以复用ac.js，
    constructor(options = {}) {
        this.options = {
          umamiUrl: options.umamiUrl || "/script.js",
          websiteId: options.websiteId || "",
          bannerPosition: options.bannerPosition || "bottom", // 'bottom', 'top', 'center'
          theme: options.theme || "light", // 'light', 'dark', 'auto'
          language: options.language || this.getBrowserLanguage(),
          expirationDays: options.expirationDays || 365,
          privacyPolicyUrl:
            options.privacyPolicyUrl || "https://privacy.yangdujun.top",
          trackOutboundLinks: options.trackOutboundLinks !== false, // 新增：默认开启外链跟踪
          euDetectionApi: options.euDetectionApi || "https://is-eu.yangdujun.top",
          enableEuDetection: options.enableEuDetection !== false,

          // 新增回调配置
          onConsentChange: options.onConsentChange || null,
          onAnalyticsLoad: options.onAnalyticsLoad || null,
          onAnalyticsRemove: options.onAnalyticsRemove || null,
          onEuDetectionComplete: options.onEuDetectionComplete || null,
          ...options,
    }; 
    但是复用不要忘记传参数初始化。
    -->
    <script type="module">
        import AnalyticsConsent from "https://cdn.yangdujun.top/js/ac.js";
        import { PingMonitor } from "https://cdn.yangdujun.top/js/ac.js"
        const pingMonitor = new PingMonitor();
        let customEventTriggered = false

        document.addEventListener("DOMContentLoaded", function () {
            const analytics = new AnalyticsConsent({
                umamiUrl: "https://js.yangdujun.top/version.js",
                websiteId: "02d69265-97af-44ea-9e73-9607ee9076bc",
                theme: "auto",
                onConsentChange: function (consent, isEUUser, source) {
                    if (consent && !customEventTriggered) {
                        customEventTriggered = true;
                        sendConsentEvent(source, isEUUser);
                    }
                },
            });
            function sendConsentEvent(source, isEUUser) {

                // 使用事件名称 + 事件数据的方式
                const eventData = {
                    referrer: document.referrer || "direct",
                    usergent: navigator.userAgent || "Unknown"
                };

                // 等待 umami 可用
                const waitForUmami = setInterval(() => {
                    if (window.umami) {
                        clearInterval(waitForUmami);
                        pingMonitor.start();
                        umami.track("consent_approved", eventData);
                    }
                }, 100);

                // 10秒超时
                setTimeout(() => clearInterval(waitForUmami), 10000);
            }
        });
    </script>
</body>

</html>